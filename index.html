<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUKUNA MASTER - DATABASE V4.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Cairo:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f3ff; --magenta: #ff00ff; --dark: #050505; }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Cairo', sans-serif; overflow: hidden; }
        #particles-js { position: absolute; width: 100%; height: 100%; z-index: 1; }
        .hero { position: relative; z-index: 2; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .app-card { background: rgba(255, 255, 255, 0.02); padding: 30px; border-radius: 25px; border: 1px solid rgba(0, 243, 255, 0.2); backdrop-filter: blur(15px); width: 85%; max-width: 380px; text-align: center; }
        .logo { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--neon); box-shadow: 0 0 15px var(--neon); cursor: pointer; }
        h1 { font-family: 'Orbitron', sans-serif; color: var(--neon); text-shadow: 0 0 10px var(--neon); }
        .g-btn { width: 100%; background: linear-gradient(45deg, #111, #1a1a1a); border: 1px solid var(--neon); color: white; padding: 15px; border-radius: 10px; font-weight: 900; cursor: pointer; margin-top: 15px; }
        .g-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø© */
        #adminPanel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: none; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .admin-header { border-bottom: 2px solid var(--neon); padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        
        /* Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
        .player-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8rem; }
        .player-table th { background: var(--neon); color: #000; padding: 10px; text-align: right; }
        .player-table td { padding: 10px; border-bottom: 1px solid #333; color: #ccc; }
        .del-btn { background: #ff4444; border: none; color: white; padding: 5px; border-radius: 4px; }
        .whatsapp-link { color: #25D366; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div id="particles-js"></div>

<div class="hero">
    <div class="app-card">
        <img src="abc.jpg" class="logo" onclick="checkAdmin()">
        <h1>SUKUNA MASTER</h1>
        <div id="btn-container">
            <button class="g-btn" id="btn_reg" onclick="registerFlow()">ğŸ† ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</button>
            <button class="g-btn" onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹...')">âš¡ Ù‚Ø³Ù… Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª</button>
        </div>
    </div>
</div>

<div id="adminPanel">
    <div class="admin-header">
        <h2 style="color: var(--neon);">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h2>
        <button onclick="closeAdmin()" style="color:red; background:none; border:1px solid red; border-radius:5px;">X</button>
    </div>
    
    <div style="margin-bottom: 20px;">
        <span>Ø§Ù„Ø­Ø§Ù„Ø©: </span><button id="toggleReg" onclick="toggleBtn('btn_reg')" style="padding:5px 10px;"></button>
        <span style="margin-right:20px;">Ø§Ù„Ø¹Ø¯Ø¯: <b id="count">0</b></span>
    </div>

    <table class="player-table">
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>ID</th>
                <th>ÙˆØ§ØªØ³Ø§Ø¨</th>
                <th>Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
    <button onclick="clearAll()" style="width:100%; padding:15px; margin-top:20px; background:#222; color:red; border:1px solid red; border-radius:10px;">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { databaseURL: "https://project-fe025bb5-b1cc-4b8f-93e-default-rtdb.firebaseio.com" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    onValue(ref(db, 'settings/btn_reg'), (snap) => {
        const status = snap.val();
        document.getElementById('btn_reg').disabled = (status === "off");
        document.getElementById('btn_reg').innerText = status === "off" ? "âŒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØºÙ„Ù‚" : "ğŸ† ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©";
        document.getElementById('toggleReg').innerText = status === "off" ? "ÙØªØ­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" : "Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
    });

    // 2. Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø£Ø¯Ù…Ù†
    onValue(ref(db, 'players'), (snapshot) => {
        const tbody = document.getElementById('tableBody');
        const countSpan = document.getElementById('count');
        tbody.innerHTML = "";
        let count = 0;

        if (snapshot.exists()) {
            snapshot.forEach((child) => {
                count++;
                const p = child.val();
                tbody.innerHTML += `
                    <tr>
                        <td>${p.name}</td>
                        <td>${p.id}</td>
                        <td><a class="whatsapp-link" href="https://wa.me/${p.phone}" target="_blank">ÙˆØ§ØªØ³Ø§Ø¨</a></td>
                        <td><button class="del-btn" onclick="deletePlayer('${child.key}')">X</button></td>
                    </tr>
                `;
            });
            countSpan.innerText = count;
        } else {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            countSpan.innerText = "0";
        }
    });

    // 3. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø±Ù‚Ù… + ID)
    window.registerFlow = async () => {
        if (localStorage.getItem('registered')) return alert("Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹!");

        const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:");
        if (!name) return;
        const id = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:");
        if (!id) return;
        const phone = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù…Ø«Ù„ 2010...):");
        if (!phone) return;

        // ÙØ­Øµ Ø§Ù„Ù€ ID Ø§Ù„Ù…ÙƒØ±Ø±
        const snap = await get(ref(db, 'players'));
        let dup = false;
        if(snap.exists()) snap.forEach(c => { if(c.val().id === id) dup = true; });
        if(dup) return alert("Ù‡Ø°Ø§ Ø§Ù„Ù€ ID Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„!");

        push(ref(db, 'players'), { name, id, phone, time: new Date().toLocaleString() })
        .then(() => {
            localStorage.setItem('registered', 'true');
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!");
        });
    };

    // 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù†
    window.deletePlayer = (key) => { if(confirm("Ø­Ø°ÙØŸ")) remove(ref(db, 'players/'+key)); };
    window.clearAll = () => { if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ")) remove(ref(db, 'players')); };
    window.toggleBtn = async (id) => {
        const snap = await get(ref(db, 'settings/'+id));
        set(ref(db, 'settings/'+id), snap.val() === "off" ? "on" : "off");
    };

    // 5. Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
    let clicks = 0;
    window.checkAdmin = () => {
        clicks++;
        if(clicks >= 5) {
            if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "cheats777") document.getElementById('adminPanel').style.display = 'block';
            clicks = 0;
        }
    };
    window.closeAdmin = () => document.getElementById('adminPanel').style.display = 'none';

    particlesJS('particles-js', { "particles": { "number": { "value": 50 }, "color": { "value": "#00f3ff" }, "line_linked": { "enable": true, "color": "#00f3ff" }, "move": { "speed": 3 } } });
</script>
</body>
</html>
